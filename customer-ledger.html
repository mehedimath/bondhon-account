<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Customer Ledger - Bondhon Enterprise</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        width: 250px;
        padding: 70px 0 0;
        background-color: #f8f9fa;
        color: #212529;
        height: 100vh;
        overflow-y: auto;
      }

      .sidebar .nav-link {
        color: #212529;
        padding: 10px 20px;
      }

      .sidebar .nav-link:hover,
      .sidebar .nav-link.active {
        color: #212529;
        background-color: #e4e5e6;
      }

      .sidebar .nav-link .fa {
        width: 20px;
        text-align: center;
        margin-right: 10px;
      }

      .nav-sub-link {
        margin-left: 50px;
      }

      .main-content {
        margin-left: 250px;
        padding: 20px;
        padding-top: 70px;
      }

      .navbar {
        z-index: 1030;
      }

      .navbar-brand {
        font-weight: 700;
      }

      .stat-card {
        text-align: center;
      }

      .stat-card .stat-value {
        font-size: 1.75rem;
        font-weight: 700;
      }

      .stat-card .stat-label {
        font-size: 0.9rem;
        color: #6c757d;
      }

      .tr-sale {
        border-left: 4px solid #0d6efd;
      }

      .tr-payment {
        border-left: 4px solid #198754;
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="dashboard.html">Bondhon Enterprise</a>
        <div class="ms-auto d-flex align-items-center">
          <div class="user-info me-3">
            <i class="fa fa-user-circle"></i> Admin
          </div>
          <a href="index.html" class="btn btn-outline-light btn-sm"
            ><i class="fa fa-sign-out-alt me-1"></i>Logout</a
          >
        </div>
      </div>
    </nav>

    <!-- Sidebar -->

    <div class="sidebar">
      <nav class="nav flex-column">
        <a class="nav-link active" href="dashboard.html"
          ><i class="fa fa-tachometer-alt fa-fw"></i> Dashboard</a
        >
        <a class="nav-link" href="all-create.html"
          ><i class="fa fa-tachometer-alt fa-fw"></i> Quick Add</a
        >
        <a
          class="nav-link"
          data-bs-toggle="collapse"
          href="#contactsCollapse"
          role="button"
          aria-expanded="true"
        >
          <i class="fa fa-users fa-fw"></i> Contacts
          <i class="fa fa-chevron-down fa-xs float-end mt-1"></i>
        </a>
        <div class="collapse show" id="contactsCollapse">
          <nav class="nav flex-column">
            <a class="nav-link nav-sub-link" href="customers-list.html"
              >Customers</a
            >
            <a class="nav-link nav-sub-link" href="suppliers-manage.html"
              >Suppliers</a
            >
          </nav>
        </div>
        <a
          class="nav-link"
          data-bs-toggle="collapse"
          href="#inventoryCollapse"
          role="button"
          aria-expanded="true"
        >
          <i class="fa fa-box-open fa-fw"></i> Inventory
          <i class="fa fa-chevron-down fa-xs float-end mt-1"></i>
        </a>
        <div class="collapse show" id="inventoryCollapse">
          <nav class="nav flex-column">
            <a class="nav-link nav-sub-link" href="inventory-products.html"
              >Product List</a
            >
            <a class="nav-link nav-sub-link" href="items-manage.html"
              >Item Categories</a
            >
            <a class="nav-link nav-sub-link" href="brands-manage.html"
              >Brands</a
            >
          </nav>
        </div>
        <a
          class="nav-link"
          data-bs-toggle="collapse"
          href="#purchasesCollapse"
          role="button"
          aria-expanded="true"
        >
          <i class="fa fa-shopping-cart fa-fw"></i> Purchases
          <i class="fa fa-chevron-down fa-xs float-end mt-1"></i>
        </a>
        <div class="collapse show" id="purchasesCollapse">
          <nav class="nav flex-column">
            <a class="nav-link nav-sub-link" href="purchases-create.html"
              >New Purchase</a
            >
            <a class="nav-link nav-sub-link" href="purchase_list.html"
              >Purchase List</a
            >
          </nav>
        </div>
        <a
          class="nav-link"
          data-bs-toggle="collapse"
          href="#salesCollapse"
          role="button"
          aria-expanded="true"
        >
          <i class="fa fa-file-invoice-dollar fa-fw"></i> Sales
          <i class="fa fa-chevron-down fa-xs float-end mt-1"></i>
        </a>
        <div class="collapse show" id="salesCollapse">
          <nav class="nav flex-column">
            <a class="nav-link nav-sub-link" href="sales-create.html"
              >New Invoice</a
            >
            <a class="nav-link nav-sub-link" href="sales-manage-invoices.html"
              >Invoice List</a
            >
            <a class="nav-link nav-sub-link" href="sales-return-create.html"
              >Process Return</a
            >
          </nav>
        </div>
        <a
          class="nav-link"
          data-bs-toggle="collapse"
          href="#financeCollapse"
          role="button"
          aria-expanded="true"
        >
          <i class="fa fa-wallet fa-fw"></i> Finance
          <i class="fa fa-chevron-down fa-xs float-end mt-1"></i>
        </a>
        <div class="collapse show" id="financeCollapse">
          <nav class="nav flex-column">
            <a class="nav-link nav-sub-link" href="expenses-manage.html"
              >Manage Expenses</a
            >
          </nav>
        </div>
        <!-- New Collection Links -->
        <a
          class="nav-link"
          data-bs-toggle="collapse"
          href="#collectionsCollapse"
          role="button"
          aria-expanded="true"
          ><i class="fa fa-hand-holding-dollar fa-fw"></i> Collections
          <i class="fa fa-chevron-down fa-xs float-end mt-1"></i
        ></a>
        <div class="collapse show" id="collectionsCollapse">
          <nav class="nav flex-column">
            <a class="nav-link nav-sub-link" href="emi-collection.html"
              >EMI Collection</a
            ><a class="nav-link nav-sub-link" href="due-collection.html"
              >Due Collection</a
            ><a class="nav-link nav-sub-link" href="customer-ledger.html"
              >Customer Ledger</a
            >
          </nav>
        </div>

        <a
          class="nav-link"
          data-bs-toggle="collapse"
          href="#accountingCollapse"
          role="button"
          aria-expanded="true"
          ><i class="fa fa-hand-holding-dollar fa-fw"></i> Accounting
          <i class="fa fa-chevron-down fa-xs float-end mt-1"></i
        ></a>
        <div class="collapse show" id="accountingCollapse">
          <nav class="nav flex-column">
            <a class="nav-link nav-sub-link" href="account-dashboard.html"
              >Accounts Dashboard</a
            ><a class="nav-link nav-sub-link" href="voucher_form.html"
              >Voucher Entry</a
            ><a class="nav-link nav-sub-link" href="voucher-list.html"
              >Voucher List</a
            ><a class="nav-link nav-sub-link" href="trial-balance.html"
              >Trial Balance</a
            ><a class="nav-link nav-sub-link" href="balance-sheet.html"
              >Balance Sheet</a
            >
          </nav>
        </div>

        <a
          class="nav-link"
          data-bs-toggle="collapse"
          href="#reportsCollapse"
          role="button"
          aria-expanded="true"
        >
          <i class="fa fa-chart-pie fa-fw"></i> Reports
          <i class="fa fa-chevron-down fa-xs float-end mt-1"></i>
        </a>
        <div class="collapse show" id="reportsCollapse">
          <nav class="nav flex-column">
            <a class="nav-link nav-sub-link" href="reports-sales.html"
              >Sales Report</a
            >
            <a class="nav-link nav-sub-link" href="reports-stock-ledger.html"
              >Stock Ledger</a
            >
            <a class="nav-link nav-sub-link" href="reports-customer-dues.html"
              >Customer Dues</a
            >
          </nav>
        </div>
        <a class="nav-link" href="settings.html"
          ><i class="fa fa-cog fa-fw"></i> Settings</a
        >
      </nav>
    </div>

    <main class="main-content">
      <div class="container-fluid">
        <h1 class="h3 mb-4">Customer Ledger</h1>
        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title">Select Customer</h5>
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                id="searchInput"
                placeholder="Search by Customer Name or Contact"
                list="customer-list"
              />
              <datalist id="customer-list">
                <option
                  data-id="cust1"
                  value="Md. Mahfooz | 01613-505311"
                ></option>
                <option
                  data-id="cust2"
                  value="Rana (Sukran Group) | 01405-591026"
                ></option>
                <option
                  data-id="cust3"
                  value="Salma Akter | 01773-047204"
                ></option>
              </datalist>

              <button class="btn btn-primary" type="button" id="searchBtn">
                <i class="fa fa-search me-1"></i> View Ledger
              </button>
            </div>
          </div>
        </div>

        <div class="d-none" id="ledgerContainer">
          <!-- Customer Summary -->
          <div class="card mb-4">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-4">
                  <h4 class="mb-0" id="customerName"></h4>
                  <p class="text-muted mb-0" id="customerContact"></p>
                </div>
                <div class="col-md-8">
                  <div class="row">
                    <div class="col-4 stat-card border-end">
                      <div
                        class="stat-value text-primary"
                        id="totalBilled"
                      ></div>
                      <div class="stat-label">Total Billed</div>
                    </div>
                    <div class="col-4 stat-card border-end">
                      <div class="stat-value text-success" id="totalPaid"></div>
                      <div class="stat-label">Total Paid</div>
                    </div>
                    <div class="col-4 stat-card">
                      <div class="stat-value text-danger" id="totalDue"></div>
                      <div class="stat-label">Balance Due</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Transaction History -->
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Transaction History</h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead class="table-light">
                    <tr>
                      <th>Date</th>
                      <th>Transaction Type</th>
                      <th>Details</th>
                      <th class="text-end">Debit (Billed)</th>
                      <th class="text-end">Credit (Paid)</th>
                    </tr>
                  </thead>
                  <tbody id="ledgerTbody">
                    <!-- Populated by JS -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="text-center mt-4" id="placeholderText">
          <i class="fa fa-search fa-3x text-muted mb-2"></i>
          <p class="text-muted">
            Search for a customer to view their complete transaction ledger.
          </p>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const ledgerData = {
          cust1: {
            name: "Md. Mahfooz",
            contact: "01613-505311",
            transactions: [
              {
                date: "2025-03-03",
                type: "Sale",
                details: "Invoice #6084 (SMART TV)",
                debit: 28000.0,
                credit: 0,
              },
              {
                date: "2025-03-03",
                type: "Payment",
                details: "Down Payment for INV-6084",
                debit: 0,
                credit: 10000.0,
              },
              {
                date: "2025-04-03",
                type: "EMI Payment",
                details: "Installment #1 for INV-6084",
                debit: 0,
                credit: 2549.5,
              },
              {
                date: "2025-05-03",
                type: "EMI Payment",
                details: "Installment #2 for INV-6084",
                debit: 0,
                credit: 2549.5,
              },
            ],
          },
          cust2: {
            name: "Rana (Sukran Group)",
            contact: "01405-591026",
            transactions: [
              {
                date: "2025-02-15",
                type: "Sale",
                details: "Invoice #6083 (REFRIGERATOR)",
                debit: 45500.0,
                credit: 0,
              },
              {
                date: "2025-02-15",
                type: "Payment",
                details: "Initial Payment for INV-6083",
                debit: 0,
                credit: 30000.0,
              },
              {
                date: "2025-06-10",
                type: "Sale",
                details: "Invoice #6091 (CEILING FAN)",
                debit: 3520.0,
                credit: 0,
              },
            ],
          },
          cust3: {
            name: "Salma Akter",
            contact: "01773-047204",
            transactions: [
              {
                date: "2025-06-20",
                type: "Sale",
                details: "Invoice #6079 (WASHING MACHINE)",
                debit: 35000.0,
                credit: 0,
              },
              {
                date: "2025-06-20",
                type: "Payment",
                details: "Down Payment for INV-6079",
                debit: 0,
                credit: 25000.0,
              },
            ],
          },
        };

        const searchBtn = document.getElementById("searchBtn");
        const ledgerContainer = document.getElementById("ledgerContainer");
        const placeholderText = document.getElementById("placeholderText");

        function formatCurrency(num) {
          return `à§³ ${num.toLocaleString("en-IN", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          })}`;
        }

        function displayLedger(customerId) {
          const data = ledgerData[customerId];
          if (!data) return;

          // Display customer info
          document.getElementById("customerName").textContent = data.name;
          document.getElementById("customerContact").textContent = data.contact;

          // Calculate totals
          let totalBilled = 0;
          let totalPaid = 0;
          const tbody = document.getElementById("ledgerTbody");
          tbody.innerHTML = "";

          data.transactions.forEach((tx) => {
            totalBilled += tx.debit;
            totalPaid += tx.credit;

            let rowClass = tx.debit > 0 ? "tr-sale" : "tr-payment";
            let typeBadge =
              tx.debit > 0 ? "badge bg-primary" : "badge bg-success";

            const rowHtml = `
                    <tr class="${rowClass}">
                        <td>${new Date(
                          tx.date + "T00:00:00"
                        ).toLocaleDateString("en-GB")}</td>
                        <td><span class="${typeBadge}">${tx.type}</span></td>
                        <td>${tx.details}</td>
                        <td class="text-end text-primary">${
                          tx.debit > 0 ? formatCurrency(tx.debit) : "-"
                        }</td>
                        <td class="text-end text-success">${
                          tx.credit > 0 ? formatCurrency(tx.credit) : "-"
                        }</td>
                    </tr>`;
            tbody.insertAdjacentHTML("beforeend", rowHtml);
          });

          const balanceDue = totalBilled - totalPaid;

          // Update summary cards
          document.getElementById("totalBilled").textContent =
            formatCurrency(totalBilled);
          document.getElementById("totalPaid").textContent =
            formatCurrency(totalPaid);
          document.getElementById("totalDue").textContent =
            formatCurrency(balanceDue);

          ledgerContainer.classList.remove("d-none");
          placeholderText.classList.add("d-none");
        }

        searchBtn.addEventListener("click", () => {
          const searchInput = document.getElementById("searchInput").value;
          const selectedOption = Array.from(
            document.getElementById("customer-list").options
          ).find((opt) => opt.value === searchInput);

          if (selectedOption) {
            const customerId = selectedOption.dataset.id;
            displayLedger(customerId);
          } else {
            alert("Please select a valid customer from the list.");
          }
        });
      });
    </script>
  </body>
</html>
