<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Due Collection - Bondhon Enterprise</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 250px;
            padding: 70px 0 0;
            background-color: #f8f9fa;
            color: #212529;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar .nav-link {
            color: #212529;
            padding: 10px 20px
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: #212529;
            background-color: #e4e5e6
        }

        .sidebar .nav-link .fa {
            width: 20px;
            text-align: center;
            margin-right: 10px
        }

        .nav-sub-link {
            margin-left: 50px;
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
            padding-top: 70px
        }

        .navbar {
            z-index: 1030
        }

        .navbar-brand {
            font-weight: 700
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html">Bondhon Enterprise</a>
            <div class="ms-auto d-flex align-items-center">
                <div class="user-info me-3"><i class="fa fa-user-circle"></i> Admin</div><a href="index.html"
                    class="btn btn-outline-light btn-sm"><i class="fa fa-sign-out-alt me-1"></i>Logout</a>
            </div>
        </div>
    </nav>


    <!-- Sidebar -->

    <div class="sidebar">
        <nav class="nav flex-column">
            <a class="nav-link active" href="dashboard.html"><i class="fa fa-tachometer-alt fa-fw"></i> Dashboard</a>
            <a class="nav-link" href="all-create.html"><i class="fa fa-tachometer-alt fa-fw"></i> Quick Add</a>
            <a class="nav-link" data-bs-toggle="collapse" href="#contactsCollapse" role="button" aria-expanded="true">
                <i class="fa fa-users fa-fw"></i> Contacts <i class="fa fa-chevron-down fa-xs float-end mt-1"></i>
            </a>
            <div class="collapse show" id="contactsCollapse">
                <nav class="nav flex-column">
                    <a class="nav-link nav-sub-link" href="customers-list.html">Customers</a>
                    <a class="nav-link nav-sub-link" href="suppliers-manage.html">Suppliers</a>
                </nav>
            </div>
            <a class="nav-link" data-bs-toggle="collapse" href="#inventoryCollapse" role="button" aria-expanded="true">
                <i class="fa fa-box-open fa-fw"></i> Inventory <i class="fa fa-chevron-down fa-xs float-end mt-1"></i>
            </a>
            <div class="collapse show" id="inventoryCollapse">
                <nav class="nav flex-column">
                    <a class="nav-link nav-sub-link" href="inventory-dashboard.html">Inventory Dashboard</a>
                    <a class="nav-link nav-sub-link" href="inventory-products.html">Product List</a>
                    <a class="nav-link nav-sub-link" href="items-manage.html">Item Categories</a>
                    <a class="nav-link nav-sub-link" href="brands-manage.html">Brands</a>
                </nav>
            </div>
            <a class="nav-link" data-bs-toggle="collapse" href="#purchasesCollapse" role="button" aria-expanded="true">
                <i class="fa fa-shopping-cart fa-fw"></i> Purchases <i
                    class="fa fa-chevron-down fa-xs float-end mt-1"></i>
            </a>
            <div class="collapse show" id="purchasesCollapse">
                <nav class="nav flex-column">
                    <a class="nav-link nav-sub-link" href="purchase-dashboard.html">Purchase Dashboard</a>
                    <a class="nav-link nav-sub-link" href="purchases-create.html">New Purchase</a>
                    <a class="nav-link nav-sub-link" href="purchase_list.html">Purchase List</a>
                </nav>
            </div>
            <a class="nav-link" data-bs-toggle="collapse" href="#salesCollapse" role="button" aria-expanded="true">
                <i class="fa fa-file-invoice-dollar fa-fw"></i> Sales <i
                    class="fa fa-chevron-down fa-xs float-end mt-1"></i>
            </a>
            <div class="collapse show" id="salesCollapse">
                <nav class="nav flex-column">
                    <a class="nav-link nav-sub-link" href="sales-dashboard.html">Sales Dashboard</a>
                    <a class="nav-link nav-sub-link" href="sales-create.html">New Invoice</a>
                    <a class="nav-link nav-sub-link" href="sales-manage-invoices.html">Invoice List</a>
                    <a class="nav-link nav-sub-link" href="sales-return-create.html">Process Return</a>
                </nav>
            </div>
            <a class="nav-link" data-bs-toggle="collapse" href="#financeCollapse" role="button" aria-expanded="true">
                <i class="fa fa-wallet fa-fw"></i> Finance <i class="fa fa-chevron-down fa-xs float-end mt-1"></i>
            </a>
            <div class="collapse show" id="financeCollapse">
                <nav class="nav flex-column">
                    <a class="nav-link nav-sub-link" href="expenses-manage.html">Manage Expenses</a>
                </nav>
            </div>
            <!-- New Collection Links -->
            <a class="nav-link" data-bs-toggle="collapse" href="#collectionsCollapse" role="button"
                aria-expanded="true"><i class="fa fa-hand-holding-dollar fa-fw"></i> Collections <i
                    class="fa fa-chevron-down fa-xs float-end mt-1"></i></a>
            <div class="collapse show" id="collectionsCollapse">
                <nav class="nav flex-column"><a class="nav-link nav-sub-link" href="emi-collection.html">EMI
                        Collection</a><a class="nav-link nav-sub-link" href="due-collection.html">Due Collection</a><a
                        class="nav-link nav-sub-link" href="customer-ledger.html">Customer Ledger</a></nav>
            </div>
            <a class="nav-link" data-bs-toggle="collapse" href="#reportsCollapse" role="button" aria-expanded="true">
                <i class="fa fa-chart-pie fa-fw"></i> Reports <i class="fa fa-chevron-down fa-xs float-end mt-1"></i>
            </a>
            <div class="collapse show" id="reportsCollapse">
                <nav class="nav flex-column">
                    <a class="nav-link nav-sub-link" href="stock-dashboard.html">Stock Dashboard</a>
                    <a class="nav-link nav-sub-link" href="reports-sales.html">Sales Report</a>
                    <a class="nav-link nav-sub-link" href="reports-stock-ledger.html">Stock Ledger</a>
                    <a class="nav-link nav-sub-link" href="reports-customer-dues.html">Customer Dues</a>
                </nav>
            </div>

            <a class="nav-link" data-bs-toggle="collapse" href="#accountingCollapse" role="button" aria-expanded="true">
                <i class="fa fa-chart-pie fa-fw"></i> Accounts <i class="fa fa-chevron-down fa-xs float-end mt-1"></i>
            </a>
            <div class="collapse show" id="accountingCollapse">
                <nav class="nav flex-column">
                    <a class="nav-link nav-sub-link" href="voucher_form.html">Voucher Posting</a>
                    <a class="nav-link nav-sub-link" href="voucher-list.html">Voucher List</a><a
                        class="nav-link nav-sub-link" href="trial-balance.html">Trial Balance</a>
                </nav>
            </div>


            <a class="nav-link" href="settings.html"><i class="fa fa-cog fa-fw"></i> Settings</a>
        </nav>
    </div>

    <main class="main-content">
        <div class="container-fluid">
            <h1 class="h3 mb-4">Collect Due Payment</h1>

            <div class="row">
                <div class="col-lg-5">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-3">Find Customer / Invoice</h5>
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchInput"
                                    placeholder="Search by Customer or Invoice #" list="due-customer-list">
                                <datalist id="due-customer-list">
                                    <option data-customer-name="Rana (Sukran Group)" data-contact="01405-591026"
                                        data-invoice="6083" data-due="15500.00" value="INV-6083 | Rana (Sukran Group)">
                                    <option data-customer-name="Anonymous Customer" data-contact="N/A"
                                        data-invoice="6081" data-due="500.00" value="INV-6081 | Anonymous Customer">
                                </datalist>
                                <button class="btn btn-primary" type="button" id="searchBtn"><i
                                        class="fa fa-search me-1"></i> Search</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-7">
                    <div class="card d-none" id="collectionContainer">
                        <div class="card-header">
                            <h5 class="mb-0">Payment Collection</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Customer:</label>
                                    <p class="form-control-plaintext" id="detailsCustomerName"></p>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Invoice #:</label>
                                    <p class="form-control-plaintext" id="detailsInvoiceId"></p>
                                </div>
                            </div>
                            <div class="bg-light p-3 rounded mb-3 text-center">
                                <label class="text-muted fs-6">Current Due Amount</label>
                                <p class="h2 fw-bold text-danger mb-0" id="currentDueAmount"></p>
                            </div>
                            <form id="duePaymentForm">
                                <div class="mb-3">
                                    <label for="paymentAmount" class="form-label">Amount to Collect *</label>
                                    <input type="number" class="form-control form-control-lg" id="paymentAmount"
                                        placeholder="0.00" required>
                                </div>
                                <div class="mb-3">
                                    <label for="paymentDate" class="form-label">Payment Date</label>
                                    <input type="date" class="form-control" id="paymentDate">
                                </div>
                                <div class="mb-3">
                                    <label for="paymentNotes" class="form-label">Notes (Optional)</label>
                                    <textarea class="form-control" id="paymentNotes" rows="2"></textarea>
                                </div>
                                <div class="d-grid">
                                    <button class="btn btn-success btn-lg" type="submit"><i
                                            class="fa fa-check-circle me-2"></i>Record Payment</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="text-center mt-5" id="placeholderText">
                        <i class="fa fa-search fa-3x text-muted mb-2"></i>
                        <p class="text-muted">Search for a customer or invoice to collect a due payment.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchBtn = document.getElementById('searchBtn');
            const collectionContainer = document.getElementById('collectionContainer');
            const placeholderText = document.getElementById('placeholderText');
            const paymentForm = document.getElementById('duePaymentForm');

            // Sample Data
            const dueAccounts = {
                "6083": {
                    customerName: "Rana (Sukran Group)",
                    contact: "01405-591026",
                    dueAmount: 15500.00
                },
                "6081": {
                    customerName: "Anonymous Customer",
                    contact: "N/A",
                    dueAmount: 500.00
                }
            };

            let currentInvoiceId = null;

            function formatCurrency(num) {
                return `৳ ${num.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }

            function showDetails(invoiceId) {
                const account = dueAccounts[invoiceId];
                if (!account) return;

                currentInvoiceId = invoiceId;

                document.getElementById('detailsCustomerName').textContent = account.customerName;
                document.getElementById('detailsInvoiceId').textContent = invoiceId;
                document.getElementById('currentDueAmount').textContent = formatCurrency(account.dueAmount);
                document.getElementById('paymentAmount').max = account.dueAmount;
                document.getElementById('paymentAmount').value = '';
                document.getElementById('paymentDate').valueAsDate = new Date();

                collectionContainer.classList.remove('d-none');
                placeholderText.classList.add('d-none');
            }

            searchBtn.addEventListener('click', () => {
                const searchInput = document.getElementById('searchInput').value;
                const selectedOption = Array.from(document.getElementById('due-customer-list').options).find(opt => opt.value === searchInput);

                if (selectedOption) {
                    const invoiceId = selectedOption.dataset.invoice;
                    showDetails(invoiceId);
                } else {
                    alert('Please select a valid customer/invoice from the list.');
                }
            });

            paymentForm.addEventListener('submit', function (e) {
                e.preventDefault();
                if (!currentInvoiceId) return;

                const paymentAmount = parseFloat(document.getElementById('paymentAmount').value);
                const account = dueAccounts[currentInvoiceId];

                if (isNaN(paymentAmount) || paymentAmount <= 0) {
                    alert('Please enter a valid payment amount.');
                    return;
                }

                if (paymentAmount > account.dueAmount) {
                    alert('Payment amount cannot be greater than the due amount.');
                    return;
                }

                // Simulate saving data
                account.dueAmount -= paymentAmount;

                alert(`Successfully collected ${formatCurrency(paymentAmount)}.\nNew due balance: ${formatCurrency(account.dueAmount)}`);

                // Update UI
                if (account.dueAmount > 0) {
                    showDetails(currentInvoiceId); // Refresh details
                } else {
                    // Hide collection form if due is cleared
                    collectionContainer.classList.add('d-none');
                    placeholderText.classList.remove('d-none');
                    placeholderText.innerHTML = `<i class="fa fa-check-circle fa-3x text-success mb-2"></i><p>Due for Invoice #${currentInvoiceId} has been cleared!</p>`;
                    // Remove from datalist
                    const optionToRemove = Array.from(document.getElementById('due-customer-list').options).find(opt => opt.dataset.invoice === currentInvoiceId);
                    if (optionToRemove) optionToRemove.remove();
                    document.getElementById('searchInput').value = '';
                }
            });
        });
    </script>
</body>

</html>